<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <!-- 標題由下方的 JavaScript 動態設定，以避免任何編碼問題 -->
    <title></title> 
    
    <link rel="manifest" href="data:application/manifest+json;base64,ew0KICAibmFtZSI6ICLnjovng63loKDlkb3nvoTlubPlj7AiLA0KICAic2hvcnRfbmFtZSI6ICLnjovng63loKDlkb0iLA0KICAic3RhcnRfdXJsIjogIi4iLA0KICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwNCiAgImJhY-r9fY29sb3IiOiAiI2YwZjJmNSIsDQogICJ0aGVtZV9jb2xvciI6ICIjMjE5M2IwIiwNCiAgImRlc2NyaXB0aW9uIjogIuS4reiovuWAoOWRvSDlsZ/lsYDjgIFle+8g55u457O7IOe+hOW5s+WPsC4iLA0KICAiaWNvbnMiOiBbDQogICAgew0KICAgICAgInNyYyI6ICJodHRwczovL3d3dy5nc3RhdGljLmNvbS9pbWFnZXMvYnJhbmRpbmcvcHJvZHVjdC8xeC9zaGVldHNfMjAyMHE0XzE5MmRwLnBuZyIsDQogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsDQogICAgICAidHlwZSI6ICJpbWFnZS9wbmciDQogICAgfSwNCiAgICB7DQogICAgICAic3JjIjogImh0dHBzOi8vd3d3LmdzdGF0aWMuY29tL2ltYWdlcy9icmFuZGluZy9wcm9kdWN0LzF4L3NoZWV0c18yMDIwcTRfNTEyZHAucG5nIiwNCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwNCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyINCiAgICB9DQogIF0NCn0=">
    <meta name="theme-color" content="#2193b0"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="班級公告">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/images/branding/product/1x/sheets_2020q4_192dp.png">
    <link rel="icon" href="https://www.gstatic.com/images/branding/product/1x/docs_48dp.png">

    <style>
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; }
        iframe { width: 100%; height: 100%; border: none; }
        #loader { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; transition: opacity 0.5s ease; }
        .spinner { width: 50px; height: 50px; border: 5px solid #ccc; border-top-color: #2193b0; border-radius: 50%; animation: spin 1s linear infinite; }
        #loader p { color: #555; margin-top: 1rem; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="loader">
        <div class="spinner"></div>
        <p>正在載入應用程式...</p>
    </div>
    
    <iframe id="app-frame" style="display:none;"></iframe>

    <script>
        // 終極修正：使用 JavaScript 動態設定標題，避免 HTML 編碼問題
        document.title = '班級公告系統';

        // !! 將這裡的 URL 換成您自己的 Apps Script 網址 !!
        //const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbxoNSYO898wjjNzWf91v2rsdRF_3t5OUwzQzr1jipMoVQp2x29mS8e9xkgqJiyrdPA7/exec';
        const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbyN1GbGa4-X3jiqKiCZEkpcABNGPshCnlq_0FhHRbF2lDezvvssQE45rfCZB7XQGmDX/exec';
        
        const iframe = document.getElementById('app-frame');
        const loader = document.getElementById('loader');

        iframe.src = appsScriptUrl;

        iframe.onload = function() {
            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
                iframe.style.display = 'block';
            }, 500);
        };
        
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js?v=3') // 再次更新版本號以強制清除快取
                .then(function(registration) {
                    console.log('Service Worker v3 註冊成功:', registration);
                })
                .catch(function(error) {
                    console.log('Service Worker 註冊失敗:', error);
                });
        }
    </script>
</body>
</html>
